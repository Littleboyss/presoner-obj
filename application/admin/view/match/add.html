<!DOCTYPE html>
<html>

<head>
    <title>赛事添加</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/libs/js/bootstrap-3.3.4.css" />
    <!-- <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/BeatPicker.min.css" /> -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/select2.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/select2_lh.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/base.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/common.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/page.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/htmlCss.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/windowCss.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/libs/simditor/simditor.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/libs/layer/css/layui.css" />
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/js/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/js/bootstrap-3.3.4.js"></script>
    <!-- <script type="text/javascript" src="__PUBLIC__/Admin/libs/layer/layer.js"></script> -->
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/layer/layui.all.js"></script>
    <!--  <script type="text/javascript" src="__PUBLIC__/Admin/libs/laydate/laydate.js"></script> -->
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/js/nav.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/js/public.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/simditor/module.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/simditor/hotkeys.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/simditor/uploader.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/libs/simditor/simditor.js"></script>
</head>

<body>
    <ul class="leftMenu nav nav-tabs" role="tablist">
        <include file="nav_list" />
    </ul>
    <div class="main tab-content">
        <div role="tabpanel" class="tab-pane fade in active">
            <!------顶部栏目标题-------->
            <div class="topTit flexed2">
                <span>赛事添加</span>
            </div>
            <!--内容-->
            <div class="Inner">
                <div class="box boxShow">
                    <!--表格列表-->
                    <!-- <div class="table-list"> -->
                    <form class="form-inline" action="{:U('add')}" method="POST" id='addFrom' enctype="multipart/form-data">
                        <table class="tablelist">
                            <tr class="typeList">
                                <td class="lftTit" width="150">赛事名称</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="name" value="大吉大利 今晚吃鸡" class="text input270" />
                                    标题字符长度(包含标点)应小于16
                                    <!--input80是输入框宽度80,更改宽度直接改标签-->
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">玩法</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <select name="game_type" id="game_type">
                                        <option value="3"> 积分赛</option>
                                        <option value="1"> 人头赛</option>
                                        <option value="2"> 吃鸡赛</option>
                                        <option value="4"> 组队赛</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">模式</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <select name="play_type" id="play_type">
                                        <option value="1"> 单人</option>
                                        <option value="2"> 双排</option>
                                        <option value="3"> 四排</option>
                                    </select>
                                </td>
                            </tr>
                            <!-- <tr class="typeList">
                                <td class="lftTit">赛事标题图片</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="img_title" id="ico1" value="{$img.img_title}" class="text input270" />

                                    <button type="button" class="layui-btn" id="wqico1">上传图片</button>(宽250*高400)
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">赛事详情图片</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" class="large text input270" id="ico2" name="img_detail" value="{$img.img_detail}">
                                    <button type="button" class="layui-btn" id="wqico2">上传图片</button>(宽320*高180)
                                </td>
                            </tr> -->
                            <tr class="typeList">
                                <td class="lftTit">是否自动投注</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <select name="is_auto_guess">
                                        <option value="1"> 是</option>
                                        <option value="2"> 否</option>
                                    </select>
                                </td>
                            </tr>
                            <!-- <tr class="typeList">
                                <td class="lftTit">报名开始时间</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="sign_stime" value="" data-beatpicker="true" id="sign_start" class="text input270"  />
                                    <button type="button" class="layui-btn" id="sign_start1">选择</button>
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">报名截止时间</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="sign_endtime" value="" class="text input270" id="sign" />
                                    <button type="button" class="layui-btn" id="sign1">选择</button>
                                </td>
                            </tr> -->
                            <tr class="typeList">
                                <td class="lftTit">赛事开始日期</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="start_time" value="" class="text input270" id="start" />
                                    <button type="button" class="layui-btn" id="start1">选择</button>
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">赛事截止时间</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="end_time" value="" class="text input270" id="end" />
                                    <button type="button" class="layui-btn" id="end1">选择</button>
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">赛事自动结算时间</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="balance_time" value="" class="text input270" id="balance" />
                                    <button type="button" class="layui-btn" id="balance1">选择</button>
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">局数</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="times" class="text input80" value="3" class="" />
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">报名费</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="cost" class="text input80" value="{$data['cost']}" class="" /> 元
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">基础奖金</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="base_price" value="0" class="text input80" /> 元
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">追加奖金</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" placeholder="0-100" class="text input80" name="add_price" value="75" /> %
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">允许报名人数</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="join_num" class="text input80" value="100" class="" />
                                </td>
                            </tr>
                            <!-- <tr class="typeList">
                                <td class="lftTit">已报名人数</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <input type="text" name="now_join" value="" class="text input80" /><span id="now_price" class="red"></span>
                                </td>
                            </tr> -->
                            <tr class="typeList">
                                <td class="lftTit">分配规则</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <!-- <select name="allot_type" id="allot_type">
                                        <volist name="data" id="rs">
                                        <option value="{$rs['id']}" <if condition="$data['type_id'] eq $i">selected</if>>{$rs['name']}</option>
                                        </volist>
                                    </select> -->
                                    <span style="cursor: pointer;" id="show_rule">查看/修改</span>
                                    <!-- <span id="add_rule">添加</span> -->
                                </td>
                            </tr>
                            <tr class="typeList">
                                <td class="lftTit">简介</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <textarea id="content" name="content" placeholder="" autofocus>
                                        <p>祝大家玩的开心，如有建议请反馈给我们，谢谢！</p>
                                    </textarea>
                                </td>
                            </tr>
                            
                            <tr class="typeList">
                                <td class="lftTit">奖励规则</td>
                                <td class="rgtInfo">
                                    <i></i>
                                    <textarea id="price_rule" name="price_rule" placeholder="" autofocus>
                                        <p>1.奖池金额为基础奖金+追加奖金，报名人数越多奖金越高！</p> <p>2.本场奖金分配：</p> <p>冠军：25%</p> <p>亚军：15%</p> <p>季军：9%</p> <p>4~10名：3%</p> <p>11~25名：2%</p> <p>3.参赛队伍获奖后，奖金将平均分给每位参赛队员。</p> <p>4.如有发现作弊者，将取消其成绩；如果是以队伍参赛，则取消整队成绩。</p> <p>5.比赛结算后，获奖用户请前往个人中心-历史参赛中领取奖金到余额。</p> 
                                    </textarea>
                                </td>
                            </tr>
                        </table>
                        <div class="flexed mar_t20">
                            <button type="submit" style="margin: auto;" class="mar_r20 btn sLan170Btn txtShadow"><em class="queDing"></em>保存</button>
                        </div>
                    </form>
                    <br />
                    <br />
                    <br />
                </div>
            </div>
        </div>
    </div>
    </div>
    <!--     <script type="text/javascript" src="__PUBLIC__/Admin/libs/js/BeatPicker.min.js"></script> -->
    <script>
    $('tr').click(function() {
        var add_price = $('input[name="add_price"]').val();
        var cost = $('input[name="cost"]').val();
        var now_join = $('input[name="now_join"]').val();
        $('#now_price').html('添加奖金=' + add_price*cost*now_join/100 +'元')
    });
    var editor1 = new Simditor({
        textarea: $('#content')
    });
    var editor3 = new Simditor({
        textarea: $('#price_rule')
    });
    upload('ico1', 'wqico1',250,400);
    upload('ico2', 'wqico2',320,180);

    function upload(ico1, wqico1,width,height) {
        layui.use('upload', function() {
            var inputs = '#' + ico1;
            var input = $(inputs);
            var upload = layui.upload;
            var elem = '#' + wqico1;
            //普通图片上传
            var uploadInst = upload.render({
                elem: elem,
                data: {width:width,height:height},
                url: '/index.php?m=Admin&c=Admin&a=upload',
                before: function(obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result) {
                        $('#demo1').attr('src', result); //图片链接（base64）
                    });
                },
                done: function(res) {
                    //如果上传失败
                    if (res.error == 0) {
                        input.val(res.url);
                        return layer.msg('上传成功');
                    } else {
                        return layer.msg('上传失败');
                    }
                    //上传成功
                },
                error: function() {
                    //演示失败状态，并实现重传
                    var demoText = $('#demoText');
                    demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                    demoText.find('.demo-reload').on('click', function() {
                        uploadInst.upload();
                    });
                }
            });
        })
    }
function date(elem) {    
    lay(elem+'1').on('click', function(e){ //假设 sign_start1 是一个按钮
      layui.use('laydate', function() {
        var laydate = layui.laydate;
        laydate.render({
          elem: elem
          ,type: 'datetime'
          ,format: 'yyyy-MM-dd HH:mm:ss'
          ,show: true //直接显示
          ,closeStop: elem+'1' //这里代表的意思是：点击 test1 所在元素阻止关闭事件冒泡。如果不设定，则无法弹出控件
        });
      })
    });
}

    date('#sign_start');
    date('#sign');
    date('#start');
    date('#end');
    date('#balance');

    $("#show_rule").click(function() {
        var html = $("#rule").html()
        layui.use('layer', function() {
            var layer = layui.layer;
            layer.open({
                type: 2,
                fixed: true,
                scrollbar: false,
                title: '奖金分配规则',
                zIndex: layer.zIndex,
                area: ['600px', '400px'],
                shadeClose: true,
                resize: false,
                content: "{:U('Match/price_rule')}", //这里content是一个普通的String
                success: function(layero) {
                    layer.setTop(layero); //重点2
                }
            });
        });

    })
    $('#game_type').change(function(){
        if ($(this).val() == 4) {
            $('#play_type').find('option').eq(0).hide();
            $('#play_type').val(2);
        }else{
            $('#play_type').find('option').eq(0).show();
            // $('#play_type').val(1);
        }
    })



    </script>
</body>

</html>